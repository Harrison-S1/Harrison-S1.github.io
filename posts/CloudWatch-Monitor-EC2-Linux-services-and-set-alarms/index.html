<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="CloudWatch Monitor EC2 Linux services and set alarms" /><meta property="og:locale" content="en" /><meta name="description" content="Prerequisite The Amazon CloudWatch agent is installed You have set up a IAM Role for the CloudWatch agent" /><meta property="og:description" content="Prerequisite The Amazon CloudWatch agent is installed You have set up a IAM Role for the CloudWatch agent" /><link rel="canonical" href="/posts/CloudWatch-Monitor-EC2-Linux-services-and-set-alarms/" /><meta property="og:url" content="/posts/CloudWatch-Monitor-EC2-Linux-services-and-set-alarms/" /><meta property="og:site_name" content="Sam’s 2nd brain" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-10-23T14:00:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="CloudWatch Monitor EC2 Linux services and set alarms" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-10-25T07:15:51+00:00","datePublished":"2022-10-23T14:00:00+00:00","description":"Prerequisite The Amazon CloudWatch agent is installed You have set up a IAM Role for the CloudWatch agent","headline":"CloudWatch Monitor EC2 Linux services and set alarms","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/CloudWatch-Monitor-EC2-Linux-services-and-set-alarms/"},"url":"/posts/CloudWatch-Monitor-EC2-Linux-services-and-set-alarms/"}</script><title>CloudWatch Monitor EC2 Linux services and set alarms | Sam's 2nd brain</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Sam's 2nd brain"><meta name="application-name" content="Sam's 2nd brain"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/54186142?s=400&u=fabf11da8c31b3afad7d8fbc76732b43734a685c&v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Sam's 2nd brain</a></div><div class="site-subtitle font-italic">brain of brain</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/Harrison-S1" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>CloudWatch Monitor EC2 Linux services and set alarms</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>CloudWatch Monitor EC2 Linux services and set alarms</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1666533600" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Oct 23, 2022 </em> </span> <span> Updated <em class="" data-ts="1666682151" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Oct 25, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/username">Sam</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1116 words"> <em>6 min</em> read</span></div></div></div><div class="post-content"><blockquote><p>Prerequisite</p><ul><li>The <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/download-cloudwatch-agent-commandline.html">Amazon CloudWatch</a> agent is installed<li>You have set up a <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/create-iam-roles-for-cloudwatch-agent.html">IAM Role</a> for the CloudWatch agent</ul></blockquote><h2 id="set-up-a-service-to-monitor"><span class="mr-2">Set up a service to monitor</span><a href="#set-up-a-service-to-monitor" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>At the moment CloudWatch does not monitor services as we would normally expect a monitoring system to do with a agent, <strong>is it up or down</strong>. So we need to create the metric ourselves.</p><p>Systemctl can help us there with:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>systemctl <span class="nt">-q</span> is-active httpd.service
</pre></table></code></div></div><blockquote><p><strong>is-active</strong> <em>PATTERN</em><strong>…</strong> Check whether any of the specified units are active (i.e. running). Returns an exit code <strong>0</strong> if at least one is active, or non-zero otherwise. Unless <strong>–quiet</strong> is specified, this will also print the current unit state to standard output.</p></blockquote><div class="table-wrapper"><table><tbody><tr><td>Using <code class="language-plaintext highlighter-rouge">&amp;&amp; echo "Running:1" || echo "Warning:0"</code>section is using the OR operator, so echo either 1 if systemctl command returns its exit code, the service is up <strong>echo “1”‘</strong> OR **<td> <td>** …<strong>echo “0”</strong>, which indicates the service is down.</table></div><h2 id="adding-the-metric-to-a-log-file"><span class="mr-2">Adding the metric to a log file</span><a href="#adding-the-metric-to-a-log-file" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Now we want the metric going to a logfile to pull into CloudWatch. In this example I’m using the apache package htpd. Change the log file folder and .log file name to what ever service you are wanting to monitor.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">mkdir</span> <span class="nt">-p</span> /var/log/services/ <span class="o">&amp;&amp;</span> <span class="nb">touch</span> /var/log/services/httpd_service.log
</pre></table></code></div></div><p>Now the command will look like this</p><blockquote><p>Remember to change the service folder and log name to what service you are using</p></blockquote><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>systemctl <span class="nt">-q</span> is-active httpd.service  <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"Running:1"</span> <span class="o">&gt;</span> /var/log/services/httpd_service.log <span class="o">||</span> <span class="nb">echo</span> <span class="s2">"Warning:0"</span> <span class="o">&gt;</span> /var/log/services/httpd_service.log
</pre></table></code></div></div><p>So let check, we should either have a 1 (Running) or 0 (Warning)</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">cat</span> /var/log/services/httpd_service.log
</pre></table></code></div></div><blockquote><p>If nothing is showing, you need to go back and figure out if the path is bad or the directory name is there</p></blockquote><h2 id="adding-this-to-cron"><span class="mr-2">Adding this to CRON</span><a href="#adding-this-to-cron" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Now we have data going to the log file, we need to automate it with CRON.</p><p><strong>As root</strong></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>crontab <span class="nt">-e</span>
</pre></table></code></div></div><p>and add the following:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">*</span>/1 <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> systemctl <span class="nt">-q</span> is-active httpd.service  <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"Running:1"</span> <span class="o">&gt;&gt;</span> /var/log/services/httpd_service.log <span class="o">||</span> <span class="nb">echo</span> <span class="s2">"Warning:0"</span> <span class="o">&gt;&gt;</span> /var/log/services/httpd_service.log
</pre></table></code></div></div><p>This will run every minute for testing purposes, but feel free to adjust it to what you need.</p><blockquote><p>Do not forget to change the log file path. The above example is for httpd</p></blockquote><h2 id="edit-the-cloudwatch-agent-config"><span class="mr-2">Edit the CloudWatch agent config</span><a href="#edit-the-cloudwatch-agent-config" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Now we need to configure the CloudWatch agent. Edit the CloudWatch agent configuration file.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>vim /opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent.json 
</pre></table></code></div></div><blockquote><p>This is an example of pulling the log metric only</p></blockquote><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
    </span><span class="nl">"agent"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"logfile"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/opt/aws/amazon-cloudwatch-agent/logs/amazon-cloudwatch-agent.log"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"metrics_collection_interval"</span><span class="p">:</span><span class="w"> </span><span class="mi">60</span><span class="p">,</span><span class="w">
    </span><span class="nl">"run_as_user"</span><span class="p">:</span><span class="w"> </span><span class="s2">"root"</span><span class="p">,</span><span class="w">
 </span><span class="err">.</span><span class="w">  </span><span class="nl">"debug"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"logs"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"logs_collected"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"files"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
         </span><span class="err">.</span><span class="w">      </span><span class="nl">"collect_list"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="nl">"file_path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/var/log/services/httpd_service.log"</span><span class="p">,</span><span class="w">
                        </span><span class="nl">"log_group_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/ec2/CloudWatchAgentServiceLog/"</span><span class="p">,</span><span class="w">
                        </span><span class="nl">"log_stream_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{instance_id}_{hostname}"</span><span class="p">,</span><span class="w">
                        </span><span class="nl">"timezone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Local"</span><span class="w">

                     </span><span class="p">}</span><span class="w">
                </span><span class="p">]</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>Now tell the agent to use the new config and restart the agent.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo</span> /opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent-ctl <span class="nt">-a</span> fetch-config <span class="nt">-m</span> ec2 <span class="nt">-s</span> <span class="nt">-c</span> file:/opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent.json
</pre></table></code></div></div><p>Now wait a minute and you would not have logs being pulled into CloudWatch</p><blockquote><p>if there are error it will show in the output of the previous command</p></blockquote><p>You can check the agents status with:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo</span> /opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent-ctl <span class="nt">-a</span> status
</pre></table></code></div></div><h2 id="set-up-logrotate"><span class="mr-2">Set up logrotate</span><a href="#set-up-logrotate" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Now we have logs being created and ingested into CloudWatch we need to do some house keeping on the system with logrotate.</p><p>Create a logrotate config for not just this one service, but all that we may create in the future.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">touch</span> /etc/logrotate.d/monitored_services
</pre></table></code></div></div><p>Now lets edit the config</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>vim /etc/logrotate.d/monitored_services
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>/var/log/services/<span class="k">*</span>log <span class="o">{</span>
    weekly
    missingok
    copytruncate
    rotate 12
    compress
    delaycompress
    notifempty
<span class="o">}</span>  
</pre></table></code></div></div><p>This is a good starting point. it will keep 12 weeks (3 months) worth of logs and compress them. These rules will apply to everything in <code class="language-plaintext highlighter-rouge">/var/log/servicess</code> If you need to isolate a service and have a different rule then just separate the log into its own directory. such as <code class="language-plaintext highlighter-rouge">/var/log/servicess/httpd/</code></p><h2 id="further-reading"><span class="mr-2">Further reading</span><a href="#further-reading" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>I would highly recommend going through the docs for <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch-Agent-Configuration-File-Details.html#CloudWatch-Agent-Configuration-File-Complete-Example">Manually create or edit the CloudWatch agent configuration file</a></p><h2 id="setting-up-the-cloudwatch-metric-and-alarm"><span class="mr-2">Setting up the CloudWatch Metric and Alarm</span><a href="#setting-up-the-cloudwatch-metric-and-alarm" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="metric"><span class="mr-2">Metric</span><a href="#metric" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>OK so now we want to get alerts from CloudWatch if our service goes down. We need to create a “filter” in CloudWatch and then create a alarm based on the filters status.</p><p>In the AWS console, navigate to</p><p>CloudWatch &gt; CloudWatch Logs&gt; Log groups &gt; <strong>NAMEOFLOG</strong></p><blockquote><p>If you are following along with the example the log name would be ** /ec2/CloudWatchAgentServiceLog/**</p></blockquote><p>Then under the <strong>Actions</strong> menu select <strong>Create metric filter</strong></p><p>Now we need to fill out the requirements for the <strong>Define pattern</strong> <strong>Filter pattern</strong> enter Warning</p><blockquote><p>This is the key word that is is our log file for a service going down</p></blockquote><p>Click next</p><p><strong>Filter name</strong> enter Apache down <strong>Metric namespace</strong> enter Services</p><blockquote><p>We can add other services to the namespace - its just a grouping</p></blockquote><p><strong>Metric name</strong> enter httpd down <strong>Metric value</strong> enter 1 <strong>Default value – <em>optional</em></strong> enter 0</p><blockquote><p>This will allow us to see when the service goes down on a lined graph, with a 1 indicating the service is down and the indicating normal operations</p></blockquote><p>Click Next.</p><h3 id="review-and-confirm"><span class="mr-2">Review and confirm</span><a href="#review-and-confirm" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Now when you look at the metric httpd down, you will see when the service has gone down. Set you <strong>Period</strong> to 1 min and <strong>Statistic</strong> to max in a line graph view.</p><h3 id="alarm"><span class="mr-2">Alarm</span><a href="#alarm" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>To create our alarm we need to navigate to <strong>All alarms</strong> on the left hand side panel, then click the orange <strong>Create alarm</strong>.</p><p>On the new page select **Select Metric **</p><p>Now select our Group name that we created earlier, <strong>Services</strong></p><p>and select <strong>Metric with no dimensions</strong> and select <strong>httpd down</strong></p><blockquote><p>The metric name will change for whatever you have named the metric name to be.</p></blockquote><h4 id="specify-metric-and-conditions"><span class="mr-2">Specify metric and conditions</span><a href="#specify-metric-and-conditions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Now we need to set the conditions for the alarm. You can change the metric name here if you wanted to.</p><ul><li><strong>Statistic</strong> select Maximum<blockquote><p>You want this to be the Maximum, so its either a 1 or a 0, its up or down</p></blockquote><li><strong>Period</strong> select 1 minutes<blockquote><p>Change this to meet your needs</p></blockquote><li><strong>Threshold type</strong> select Static<li><strong>Define the alarm condition</strong> select Greater/Equal<li><strong>Define the threshold value</strong> enter 1</ul><p>Click Next</p><h3 id="configure-actions"><span class="mr-2">Configure actions</span><a href="#configure-actions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><strong>Alarm state trigger</strong> set to In alarm<li><strong>Send a notification to the following SNS topic</strong><blockquote><p>If you have not already set up a SNS topic you will need to create a new topic.</p></blockquote><li>You can also create a <strong>OK</strong> alert but clicking <strong>Add notification</strong> and adding the same SNS topic you created. You will then get an alert when the service goes down and comes back up.</ul><p>Click Next</p><h4 id="add-name-and-description"><span class="mr-2">Add name and description</span><a href="#add-name-and-description" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>Give the alarm a name and description.</ul><p>Click Next</p><h4 id="preview-and-create"><span class="mr-2">Preview and create</span><a href="#preview-and-create" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Review the alarm setting and click <strong>Create alarm</strong>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/aws/'>aws</a>, <a href='/categories/howto-s/'>howto's</a>, <a href='/categories/linux/'>linux</a>, <a href='/categories/cloud/'>cloud</a>, <a href='/categories/cloudwatch/'>cloudwatch</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/aws/" class="post-tag no-text-decoration" >aws</a> <a href="/tags/linux/" class="post-tag no-text-decoration" >linux</a> <a href="/tags/howto-s/" class="post-tag no-text-decoration" >howto's</a> <a href="/tags/sysops/" class="post-tag no-text-decoration" >sysops</a> <a href="/tags/cloud/" class="post-tag no-text-decoration" >cloud</a> <a href="/tags/cloudwatch/" class="post-tag no-text-decoration" >cloudwatch</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=CloudWatch+Monitor+EC2+Linux+services+and+set+alarms+-+Sam%27s+2nd+brain&url=%2Fposts%2FCloudWatch-Monitor-EC2-Linux-services-and-set-alarms%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=CloudWatch+Monitor+EC2+Linux+services+and+set+alarms+-+Sam%27s+2nd+brain&u=%2Fposts%2FCloudWatch-Monitor-EC2-Linux-services-and-set-alarms%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2Fposts%2FCloudWatch-Monitor-EC2-Linux-services-and-set-alarms%2F&text=CloudWatch+Monitor+EC2+Linux+services+and+set+alarms+-+Sam%27s+2nd+brain" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=%2Fposts%2FCloudWatch-Monitor-EC2-Linux-services-and-set-alarms%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/atlas-project-part-two/">Atlas project - part two</a><li><a href="/posts/atlas-project-part-one/">Atlas Project - part one</a><li><a href="/posts/aws-storage-gateway/">Creating a Storage Gateway in AWS</a><li><a href="/posts/Expanding-EBS-root-volume/">Expanding EBS root volume</a><li><a href="/posts/CloudWatch-Monitor-EC2-Linux-services-and-set-alarms/">CloudWatch Monitor EC2 Linux services and set alarms</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/howto-s/">howto's</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/sysops/">sysops</a> <a class="post-tag" href="/tags/homelab/">homelab</a> <a class="post-tag" href="/tags/cloud/">cloud</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/security/">security</a> <a class="post-tag" href="/tags/ansible/">ansible</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/terraform/">terraform</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Create-a-systemd-service-to-monitor-Cloudwatch-agent/"><div class="card-body"> <em class="small" data-ts="1666387800" data-df="ll" > Oct 21, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Create a systemd service to monitor Cloudwatch agent</h3><div class="text-muted small"><p> The problem to solve If you are monitoring an AWS instance that is busy and has other programs accessing the same logs as the Cloudwatch agent then you may run into this error in the agents logs “...</p></div></div></a></div><div class="card"> <a href="/posts/Expanding-EBS-root-volume/"><div class="card-body"> <em class="small" data-ts="1663423200" data-df="ll" > Sep 17, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Expanding EBS root volume</h3><div class="text-muted small"><p> Expand the root volume. Then, extend the file system using the Amazon EC2 console (new console) From the Amazon EC2 console, choose Instances from the navigation pane. Select the ...</p></div></div></a></div><div class="card"> <a href="/posts/aws-storage-gateway/"><div class="card-body"> <em class="small" data-ts="1671285600" data-df="ll" > Dec 17, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Creating a Storage Gateway in AWS</h3><div class="text-muted small"><p> So what is a Storge Gateway? A Storage Gateway it just a way to connect AWS storage in a traditional way e.g. NFS, SMB etc. Lets build one with Terraform A fully working envriment with a Stora...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Create-a-systemd-service-to-monitor-Cloudwatch-agent/" class="btn btn-outline-primary" prompt="Older"><p>Create a systemd service to monitor Cloudwatch agent</p></a> <a href="/posts/aws-storage-gateway/" class="btn btn-outline-primary" prompt="Newer"><p>Creating a Storage Gateway in AWS</p></a></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/Harrison-S1">Sam</a>.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/howto-s/">howto's</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/sysops/">sysops</a> <a class="post-tag" href="/tags/homelab/">homelab</a> <a class="post-tag" href="/tags/cloud/">cloud</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/security/">security</a> <a class="post-tag" href="/tags/ansible/">ansible</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/terraform/">terraform</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-TSY28JSKB0"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-TSY28JSKB0'); }); </script>
